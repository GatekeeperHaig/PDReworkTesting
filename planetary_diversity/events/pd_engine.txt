namespace = pdengine

event = {
	id = pdengine.00
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { set_global_flag = planetarydiversity }
}

#This event changes all non homeworld, non prescripted to PD classes
country_event = {
	id = pdengine.01
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		#Continetal, non-ideal
        every_galaxy_planet = {                 
            limit = { 
				is_planet_class = pc_continental 
				is_homeworld = no 
				NOR = { 
					has_planet_flag = prescripted_ideal 
					has_planet_flag = pd_ignore 
					has_planet_flag = planet_earth 
				}
			}	
			random_list = {
				25 = {
					add_modifier = { modifier = pd_continental }	 
				}    
				25 = { 
					pd_retinal_world_effect = yes
				}
				25 = { 
					pd_lake_world_effect = yes
				}
				25 = { 
					pd_forest_world_effect = yes
				}
				25 = { 
					pd_temperate_world_effect = yes
				}
				25 = { 
					pd_tepid_world_effect = yes
				}  
				25 = { 
					pd_megaflora_world_effect = yes
				}
				25 = { 
					pd_pd_petrified_world_effect = yes
				}                    
			}
        }
		#Continetal, ideal
        every_galaxy_planet = {                 
            limit = { 
				is_planet_class = pc_continental 
				is_homeworld = no 
				has_planet_flag = prescripted_ideal 
			}	
			random_list = {
				25 = {
					add_modifier = { modifier = pd_continental }	 
				}    
				25 = { 
					pd_retinal_world_effect = yes
				}
				25 = { 
					pd_lake_world_effect = yes
				}
				25 = { 
					pd_forest_world_effect = yes
				}
				25 = { 
					pd_temperate_world_effect = yes
				}
				25 = { 
					pd_tepid_world_effect = yes
				}                     
			}
        }
	}
}

#This Event Changes any planets that slipped through, and any non homeworld planets
country_event = {
	id = pdengine.02
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		#Continetal Planets
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_continental
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			} 
			IF = {
				limit = {
					NOT = { has_modifier = pd_continental }
				}
				add_modifier = { modifier = pd_continental }
			}  
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_retinal
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}   
			change_pc = pc_continental          
			pd_retinal_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_lake
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}  
			change_pc = pc_continental         
			pd_lake_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_tepid
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}      
			change_pc = pc_continental     
			pd_tepid_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_temperate
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}     
			change_pc = pc_continental      
			pd_temperate_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_forest
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}  
			change_pc = pc_continental         
			pd_forest_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_forest
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}   
			change_pc = pc_continental        
			pd_forest_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_megaflora
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}  
			change_pc = pc_continental         
			pd_megaflora_world_effect = yes
		}
		every_galaxy_planet = {         
			limit = {
				is_planet_class = pc_pd_petrified
				has_pd_modifier = no
				is_homeworld = no 
				NOT = { has_planet_flag = prescripted_ideal }
			}  
			change_pc = pc_continental         
			pd_pd_petrified_world_effect = yes
		}
	}
}

#This Event Fires After Terraforming to let you choose PD classes
#Has Planet Flag = pd_choose_every_planet_terraforming
planet_event = {
	id = pdengine.03
	title = pdengine.03.name
	desc = pdengine.03.desc
	picture = GFX_evt_shattered_planet
	show_sound = event_ship_bridge
	location = root
	is_triggered_only = yes

	trigger = {
		exists = space_owner
		can_have_habitable_deposits = yes
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
			is_planet_class = pc_ocean
			is_planet_class = pc_arid
			is_planet_class = pc_desert
			is_planet_class = pc_savannah
			is_planet_class = pc_arctic
			is_planet_class = pc_alpine
			is_planet_class = pc_tundra
		}
	}

	immediate = {
		remove_pd_modifier = yes
	}

	#Continetal
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.continental
		hidden_effect = {
			add_modifier = { modifier = pd_continental }
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.retinal
		hidden_effect = {         
			pd_retinal_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.lake
		hidden_effect = {         
			pd_lake_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.forest
		hidden_effect = {         
			pd_forest_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.tepid
		hidden_effect = {         
			pd_tepid_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.temperate
		hidden_effect = {         
			pd_temperate_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
		}
		name = pdengine.03.temperate
		hidden_effect = {         
			pd_temperate_world_effect = yes
		}
	}
	#Rare Continetal
	option = {
		trigger = {
			is_planet_class = pc_continental
			OR = {
				owner = {
					has_ascension_perk = ap_world_shaper
				}
				space_owner = {
					has_ascension_perk = ap_world_shaper
				}
			}
		}
		name = pdengine.03.megaflora
		hidden_effect = {         
			pd_megaflora_world_effect = yes
		}
	}
	option = {
		trigger = {
			is_planet_class = pc_continental
			OR = {
				owner = {
					has_ascension_perk = ap_world_shaper
				}
				space_owner = {
					has_ascension_perk = ap_world_shaper
				}
			}
		}
		name = pdengine.03.petrified
		hidden_effect = {         
			pd_pd_petrified_world_effect = yes
		}
	}
}

#This Event Fires After Terraforming to let you choose PD classes
#Has Planet Flag = pd_same_as_homeworld_terraforming
#Removed from Protype for now
#planet_event = {
#	id = pdengine.04
#	hide_window = yes
#	is_triggered_only = yes
#
#	trigger = {
#		OR = {
#			owner = { 
#				has_policy_flag = pd_same_as_homeworld_terraforming 
#			}
#			space_owner = {
#				has_policy_flag = pd_same_as_homeworld_terraforming 
#			}
#		}
#	}
#
#	immediate = {
#		remove_pd_modifier = yes
#	}
#
#	#Continetal
#}

#This Event Fires After Terraforming to let you choose PD classes
#Has Planet Flag = pd_choose_every_planet_terraforming
planet_event = {
	id = pdengine.05
	hide_window = yes
	location = root
	is_triggered_only = yes

	trigger = {
		exists = space_owner
		can_have_habitable_deposits = yes
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
			is_planet_class = pc_ocean
			is_planet_class = pc_arid
			is_planet_class = pc_desert
			is_planet_class = pc_savannah
			is_planet_class = pc_arctic
			is_planet_class = pc_alpine
			is_planet_class = pc_tundra
		}
	}

	immediate = {
		remove_pd_modifier = yes
		IF = {
			limit = { 
				is_planet_class = pc_continental
			}
			random_list = {
				25 = {
					add_modifier = { modifier = pd_continental }	 
				}    
				25 = { 
					pd_retinal_world_effect = yes
				}
				25 = { 
					pd_lake_world_effect = yes
				}
				25 = { 
					pd_forest_world_effect = yes
				}
				25 = { 
					pd_temperate_world_effect = yes
				}
				25 = { 
					pd_tepid_world_effect = yes
				}  
				25 = { 
					pd_megaflora_world_effect = yes
				}
				25 = { 
					pd_pd_petrified_world_effect = yes
				}                    
			}
		}
	}
}