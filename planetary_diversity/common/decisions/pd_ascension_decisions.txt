#PD AW Decisions

#Transplanet Tree TOL
decision_pd_replant_tree_of_life = {
	owned_planets_only = yes
	sound = event_mystic_reveal
	icon = decision_pd_replant_tree_of_life

	enactment_time = 360

	resources = {
		category = decisions
		cost = {
			food = 1000
		}
	}

	potential = {
		has_modifier = pd_no_lifetree
		OR = {
			pd_is_planet_class_superhabitable = yes
			pd_is_planet_class_tidally_locked = yes
			pd_is_planet_class_cave = yes
		}
	}

	allow = { 
		has_modifier = pd_no_lifetree
		OR = {
			pd_is_planet_class_superhabitable = yes
			pd_is_planet_class_tidally_locked = yes
			pd_is_planet_class_cave = yes
		}
	}

	effect = {
		remove_modifier = pd_no_lifetree
		hidden_effect = {
			add_deposit = d_pd_tree_of_life_colony
			switch = {
				trigger = is_planet_class
				pc_habitat = {
					planet_event = {
						id = pdtreeoflife.21
						days = 2160
					}
					add_modifier = { modifier = pd_tree_of_life_growing days = 2160 }
				}
				pc_ringworld_habitable = {
					planet_event = { id = pdtreeoflife.21 days = 9000 }
					add_modifier = {
						modifier = pd_tree_of_life_growing
						days = 9000
					}
				}
				pc_continental = { 
					planet_event = { id = pdtreeoflife.21 days = 9000 }
					add_modifier = {
						modifier = pd_tree_of_life_growing
						days = 9000
					}
				}
				pc_tropical = { 
					planet_event = { id = pdtreeoflife.21 days = 9000 }
					add_modifier = {
						modifier = pd_tree_of_life_growing
						days = 9000
					}
				}
				pc_ocean = { 
					planet_event = { id = pdtreeoflife.21 days = 9000 }
					add_modifier = {
						modifier = pd_tree_of_life_growing
						days = 9000
					}
				}
				default = {
					planet_event = { id = pdtreeoflife.21 days = 18000 }
					add_modifier = {
						modifier = pd_tree_of_life_growing
						days = 18000
					}
				}
			}
			remove_modifier = pd_no_lifetree #as the planet transfer events fire before this
		}
	}

	ai_weight = {
		weight = 1000
	}
}

#Bloom Megaflora Hive
decision_pd_bloom_tree_of_life = {
	owned_planets_only = yes
	sound = event_mystic_reveal
	icon = decision_pd_aw_bloom_tree_of_life

	enactment_time = 3600

	resources = {
		category = decisions
		cost = {
			influence = 200
			food = 20000
		}
	}

	potential = {
		has_modifier = pd_tree_of_life_home
		has_deposit = d_pd_tree_of_life_home
		owner = {
			has_ascension_perk = ap_pd_tree_of_life_bloomed
		}
		is_planet_class = pc_pd_wet_gaia
	}

	effect = {
		custom_tooltip = decision_pd_bloom_tree_of_life_tooltip
		hidden_effect = {
			add_modifier = {
				modifier = pd_tree_of_life_bloomed
				days = -1
			}
			add_deposit = d_pd_tree_of_life_bloomed
			remove_modifier = pd_tree_of_life_home
			remove_deposit = d_pd_tree_of_life_home
			set_planet_entity = {
				picture = pc_pd_megaflora_hive_bloomed
				entity = megafloratol_bloomed_planet_01_entity
			}
		}
	}

	ai_weight = {
		weight = 1000
	}
}

#Flooded Worlds
@expand_planetary_sea_length = 720
decision_pd_flood_planet = {
	owned_planets_only = yes
	icon = decision_pd_flooding

	enactment_time = 1800

	potential = {
		has_global_flag = planetarydiversityascensionworlds
		OR = {
			is_planet_class = pc_pd_wet_gaia
			is_planet_class = pc_pd_wet_superhabitable
			is_planet_class = pc_pd_wet_tidally_locked
			is_planet_class = pc_pd_wet_cave
		}
		exists = owner
		owner = {
			has_ascension_perk = ap_hydrocentric
		}
		NOR = {
			has_modifier = flooded_habitat
			has_modifier = ocean_paradise
			has_modifier = ocean_paradise_hive
			has_planet_flag = pd_unique_world
		}
	}

	allow = {
		custom_tooltip = {
			fail_text = requires_free_ice_mining_station
			owner = {
				any_owned_starbase = {
					has_starbase_building = ice_mining_station
					solar_system = {
						NOT = { has_star_flag = ice_mining_in_progress }
					}
				}
			}
		}
	}

	resources = {
		category = decisions
		cost = {
			influence = 50
			energy = 2000
		}
	}

	on_queued = {
		set_variable = {
			which = decision_length
			value = @expand_planetary_sea_length
		}
		export_modifier_to_variable = {
			modifier = planet_decision_enact_speed_mult
			variable = decision_mult_var
		}
		change_variable = {
			which = decision_mult_var
			value = 1
		}
		divide_variable = {
			which = decision_length
			value = decision_mult_var
		}
		change_variable = { #ideally, may as well refer to this in the final effect
			which = decision_length
			value = 1
		}

		owner = {
			random_owned_starbase = {
				limit = {
					has_starbase_building = ice_mining_station
					solar_system = {
						NOT = { has_star_flag = ice_mining_in_progress }
					}
				}
				solar_system = {
					set_timed_star_flag = {
						flag = ice_mining_in_progress
						days = root.decision_length
					}
					set_timed_star_flag = {
						flag = ice_mining@root
						days = root.decision_length
					}
				}
			}
		}
		clear_variable = decision_length
		clear_variable = decision_mult_var
	}

	abort_trigger = {
		NOT = {
			owner = {
				any_owned_starbase = {
					has_starbase_building = ice_mining_station
				}
			}
		}
	}

	on_unqueued = {
		owner = {
			random_owned_starbase = {
				limit = {
					solar_system = {
						has_star_flag = ice_mining@root
					}
				}
				solar_system = {
					remove_star_flag = ice_mining@root
					remove_star_flag = ice_mining_in_progress
				}
			}
		}
	}

	abort_effect = {
		owner = {
			random_owned_starbase = {
				limit = {
					solar_system = {
						has_star_flag = ice_mining@root
					}
				}
				solar_system = {
					remove_star_flag = ice_mining@root
					remove_star_flag = ice_mining_in_progress
				}
			}
		}
		create_message = {
			type = ICE_MINING_INTERRUPTED
			localization = ICE_MINING_INTERRUPTED_HABITAT_DESC
			days = 20
			target = root
		}
	}

	effect = {
		custom_tooltip = decision_pd_flood_planet_tooltip
		hidden_effect = {
			add_modifier = {
				modifier = flooded_habitat
				days = -1
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_gaia
				}
				set_planet_entity = {
					picture = pc_aquatic_hot
					entity = ocean_paradise_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_superhabitable
				}
				set_planet_entity = {
					picture = pc_aquatic_hot
					entity = ocean_paradise_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_tidally_locked
				}
				set_planet_entity = {
					picture = pc_aquatic
					entity = tidallyaquatic_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_cave
				}
				set_planet_entity = {
					picture = pc_pd_aquatic_cave
					entity = aquatic_cave_planet_01_entity
				}
			}
			ice_mining_depletion_effect = yes

			if = {
				limit = {
					has_planet_flag = temp_ice_mine_exhausted_flag
				}
				event_target:mined_system.starbase = {
					remove_starbase_building = {
						building = ice_mining_station
					}
				}
				create_message = {
					type = ICE_MINING_PD_PLANET_SUCCESS
					localization = ICE_MINING_HABITAT_SUCCESS_BUT_EXHAUSTED_DESC
					days = 20
					target = root
					variable = {
						type = name
						localization = SYSTEM
						scope = event_target:mined_system
					}
				}
			}
			else = {
				create_message = {
					type = ICE_MINING_PD_PLANET_SUCCESS
					localization = ICE_MINING_PD_PLANET_SUCCESS_DESC
					days = 20
					target = root
					variable = {
						type = name
						localization = SYSTEM
						scope = event_target:mined_system
					}
				}
			}
			change_variable = {
				which = ice_dumping_happened
				value = 1
			}
		}
	}
	ai_weight = {
		weight = 1
	}
}

#Unflood Planet
decision_pd_aw_unflood_planet = {
	owned_planets_only = yes
	icon = decision_satellite_in_orbit

	enactment_time = @expand_planetary_sea_length

	potential = {
		has_global_flag = planetarydiversityascensionworlds
		OR = {
			is_planet_class = pc_pd_wet_gaia
			is_planet_class = pc_pd_wet_superhabitable
			is_planet_class = pc_pd_wet_tidally_locked
			is_planet_class = pc_pd_wet_cave
		}
		exists = owner
		has_modifier = flooded_habitat
		owner = { 
			NOT = { has_ascension_perk = ap_hydrocentric } 
		}
	}

	allow = {
	}

	resources = {
		category = decisions
		cost = {
			influence = 50
			energy = 5000
		}
	}

	effect = {
		remove_modifier = flooded_habitat
		hidden_effect = {
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_gaia
				}
				set_planet_entity = {
					picture = pc_pd_wet_gaia
					entity = gaia_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_superhabitable
				}
				set_planet_entity = {
					picture = pc_pd_wet_superhabitable
					entity = superhabitable_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_tidally_locked
				}
				set_planet_entity = {
					picture = pc_pd_wet_tidally_locked
					entity = wettidallylocked_planet_01_entity
				}
			}
			IF = {
				limit = {
					is_planet_class = pc_pd_wet_cave
				}
				set_planet_entity = {
					picture = pc_pd_wet_cave
					entity = karst_planet_01_entity
				}
			}
		}
	}

	ai_weight = {
		weight = 100
		modifier = {
			factor = 0
			owner = {
				has_trait = trait_aquatic
			}
		}
	}
}